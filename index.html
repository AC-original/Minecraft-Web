<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Minecraft 1.8.8</title>
<link rel="icon" href="icon.ico">
<style>
html,body{margin:0;width:100%;height:100%;background:#ee3038;display:flex;align-items:center;justify-content:center;font-family:sans-serif;}
#game_frame{display:none;width:100%;height:100%;}
#intro_screen{display:none;position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:1;}
#intro_video{width:100%;height:100%;object-fit:cover;}
button{padding:.8em 2em;font-size:1.2em;border:none;border-radius:8px;cursor:pointer;background:#fff;color:#000;transition:.2s;box-shadow:0 4px 10px rgba(0,0,0,.3);}
button:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.35);}
#continue_btn{display:none;position:absolute;bottom:10%;z-index:2;}
#launch_btn{position:relative;z-index:2;}
#log_display{position:absolute;top:0;left:0;color:#fff;font-family:monospace;white-space:pre-wrap;max-height:25%;overflow:auto;z-index:2;font-size:12px;}
</style>
</head>
<body>
<div id="game_frame"></div>
<div id="intro_screen">
  <video id="intro_video"></video>
  <button id="continue_btn">Continue</button>
  <pre id="log_display"></pre>
</div>
<button id="launch_btn">Launch Game</button>
<script type="module">
"use strict";
const launch=document.getElementById("launch_btn"),
      cont=document.getElementById("continue_btn"),
      logEl=document.getElementById("log_display"),
      game=document.getElementById("game_frame"),
      intro=document.getElementById("intro_screen"),
      vid=document.getElementById("intro_video");
let contPressed=false;
function log(s){logEl.textContent+=s+"\n";logEl.scrollTop=logEl.scrollHeight;}

async function setEaglerDefaults(){
  if(!localStorage.getItem("_eaglercraftX.p")){
    let profile=await fetch("profile.txt").then(r=>r.text()).catch(()=>null);
    if(profile)localStorage.setItem("_eaglercraftX.p",profile.trim());
  }
  let servers=await fetch("servers.txt").then(r=>r.text()).catch(()=>null);
  if(servers)localStorage.setItem("_eaglercraftX.s",servers.trim());
  if(!localStorage.getItem("_eaglercraftX.g")){
    let global=await fetch("global.txt").then(r=>r.text()).catch(()=>null);
    if(global)localStorage.setItem("_eaglercraftX.g",global.trim());
  }
}

function initEagler(){
  const r=Math.floor(Math.random()*3);
  window.eaglercraftXOpts={container:"game_frame",worldsDB:"worlds",relays:[
    {addr:"wss://relay.deev.is/",comment:"lax1dude relay #1",primary:r===0},
    {addr:"wss://relay.lax1dude.net/",comment:"lax1dude relay #2",primary:r===1},
    {addr:"wss://relay.shhnowisnottheti.me/",comment:"ayunami relay #1",primary:r===2}],
    assetsURI:"assets.epw"
  };
  let c=game;while(c.firstChild)c.removeChild(c);c.appendChild(document.createElement("div"));
  fetch(window.eaglercraftXOpts.assetsURI,{cache:"force-cache"})
  .then(r=>r.arrayBuffer())
  .then(buf=>{
    const dv=new DataView(buf);
    if(dv.getUint32(0,true)!==608649541||dv.getUint32(4,true)!==1297301847)return log("Invalid EPW");
    const js=new Uint8Array(buf,dv.getUint32(164,true),dv.getUint32(168,true)),
          wasm=new Uint8Array(buf,dv.getUint32(180,true),dv.getUint32(184,true)),
          jsURL=URL.createObjectURL(new Blob([js],{type:"text/javascript"})),
          wasmURL=URL.createObjectURL(new Blob([wasm],{type:"application/wasm"})),
          ctx={};
    for(const [k,v] of Object.entries(window.eaglercraftXOpts))if(k!=="container"&&k!=="assetsURI")ctx[k]=v;
    window.__eaglercraftXLoaderContextPre={rootElement:c,eaglercraftXOpts:ctx,theEPWFileBuffer:buf,loaderWASMURL:wasmURL};
    const s=document.createElement("script");s.src=jsURL;document.head.appendChild(s);
    const orig=console.log;console.log=(...a)=>{let msg=a.join(" ");log(msg);orig(...a);
      if(msg.includes("Initializing audio context")&&!contPressed)cont.style.display="block";
      if(msg.includes("EagRuntime Version: EagRuntimeX 1.0")){intro.style.display="none";game.style.display="block";}
    };
  }).catch(()=>log("Error: unable to load assets.epw"));
}

launch.onclick=async()=>{
  launch.style.display="none";
  intro.style.display="flex";
  vid.src="intro.mp4";vid.autoplay=true;vid.muted=false;vid.play();
  await setEaglerDefaults();
  initEagler();
};

cont.onclick=()=>{
  contPressed=true;
  const btn=document.querySelector("._eaglercraftX_mobile_launch_client");
  if(btn)btn.click();
  cont.style.display="none";
};
</script>
</body>
</html>


