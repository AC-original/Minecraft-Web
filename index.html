<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Minecraft Web</title>
<link rel="icon" href="icon.ico">
<style>
html,body {margin:0;height:100%;overflow:hidden;background:#ee3038}
#game_frame {display:none;width:100%;height:100%}
#introContainer {position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background:#ee3038;flex-direction:column;z-index:10}
#introVideo {width:100%;height:100%;object-fit:cover}
button {padding:14px 28px;font-size:18px;border:none;border-radius:12px;cursor:pointer;background:#fff;color:#222;box-shadow:0 4px 12px rgba(0,0,0,.3);transition:.2s;display:none;margin-top:20px}
button:hover {transform:scale(1.05)}
#logDisplay {color:#fff;font-family:monospace;margin-top:10px;text-align:center}
</style>
</head>
<body>

<div id="introContainer">
  <video id="introVideo" src="intro.mp4" playsinline></video>
  <button id="continueBtn" class="_eaglercraftX_mobile_launch_client">Continuer</button>
  <div id="logDisplay"></div>
</div>

<div id="game_frame"></div>

<script>
"use strict";

const game=document.getElementById("game_frame"),
      video=document.getElementById("introVideo"),
      continueBtn=document.getElementById("continueBtn"),
      logDisplay=document.getElementById("logDisplay");

let audioReady=false, videoDone=false, canStart=false;

// Injection du jeu
async function injectEagler(){
  const c=game;while(c.firstChild)c.removeChild(c.firstChild);
  c.appendChild(document.createElement("div"));
  let buf;
  try{buf=await fetch("assets.epw").then(r=>r.arrayBuffer())}catch{return}
  const dv=new DataView(buf);
  if(dv.getUint32(0,true)!==608649541||dv.getUint32(4,true)!==1297301847)return;
  const js=new Uint8Array(buf,dv.getUint32(164,true),dv.getUint32(168,true)),
        wasm=new Uint8Array(buf,dv.getUint32(180,true),dv.getUint32(184,true)),
        jsURL=URL.createObjectURL(new Blob([js],{type:"text/javascript"})),
        wasmURL=URL.createObjectURL(new Blob([wasm],{type:"application/wasm"})),
        ctx={};
  for(const [k,v] of Object.entries(window.eaglercraftXOpts||{}))
    if(k!=="container"&&k!=="assetsURI") ctx[k]=v;
  window.__eaglercraftXLoaderContextPre={rootElement:c,eaglercraftXOpts:ctx,theEPWFileBuffer:buf,loaderWASMURL:wasmURL};
  const s=document.createElement("script"); s.src=jsURL; document.head.appendChild(s);
}

// Afficher le jeu si toutes conditions remplies
function tryStartGame(){
  if(videoDone && audioReady && canStart){
    document.getElementById("introContainer").style.display="none";
    game.style.display="block";
  }
}

// Bouton continuer
continueBtn.onclick=()=>{
  canStart=true;
  tryStartGame();
};

// Fin de la vidéo
video.onended=()=>{
  videoDone=true;
  tryStartGame();
};
video.play();

// Interception des logs
(function(){
  const log=console.log;
  console.log=function(...args){
    log.apply(console,args);
    const msg=args.join(" ");
    logDisplay.textContent=msg;
    if(msg.includes("Initializing audio context")){
      audioReady=true;
      continueBtn.style.display="inline-block";
      tryStartGame();
    }
  };
})();

// Injecter le jeu dès que le script charge
injectEagler();
</script>

</body>
</html>
